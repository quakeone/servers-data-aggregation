using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.Extensions.Logging;
using ServerDataAggregation.Persistence.Models;
using ServersDataAggregation.Common;
using ServersDataAggregation.Common.Model;
using System.Text.Json;
using Db = ServerDataAggregation.Persistence.Models;

namespace ServersDataAggregation.Service.Services.QSBApp
{
    internal class Service
    {
        const string DUMP = @"[{""ServerId"":3, ""GameId"":0, ""Port"":26000, ""Address"":""central.jur4ss1c.net"", ""Country"":null, ""Locality"":""somewhere"", ""QueryInterval"":30, ""Mod"":null, ""Active"":true, ""ApiKey"":""00000000-0000-0000-0000-000000000000"", ""Parameters"":null, ""Source"":""QSB"", ""Metadata"":null},{""ServerId"":11,""GameId"":0,""Port"":26000,""Address"":""178.174.175.225"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""FFA"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":16,""GameId"":0,""Port"":26001,""Address"":""chicago.q1dm.tk"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""Coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":17,""GameId"":0,""Port"":26120,""Address"":""central.jur4ss1c.net"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":24,""GameId"":0,""Port"":26002,""Address"":""west.enemyquad.com"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":26,""GameId"":0,""Port"":26001,""Address"":""iowa.q1dm.tk"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""Coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":27,""GameId"":0,""Port"":26000,""Address"":""chicago.q1dm.tk"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":28,""GameId"":0,""Port"":26000,""Address"":""iowa.q1dm.tk"",""Country"":null,""Locality"":""N/A"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":33,""GameId"":0,""Port"":26000,""Address"":""chi.quakeone.com"",""Country"":null,""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":34,""GameId"":0,""Port"":26001,""Address"":""denver.quakeone.com"",""Country"":null,""Locality"":""denver"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":35,""GameId"":0,""Port"":26000,""Address"":""denver.quakeone.com"",""Country"":null,""Locality"":""denver"",""QueryInterval"":30,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":38,""GameId"":5,""Port"":27004,""Address"":""154.0.6.108"",""Country"":null,""Locality"":""South Africa"",""QueryInterval"":10,""Mod"":""DM"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":39,""GameId"":5,""Port"":26000,""Address"":""embyservice.dynu.net"",""Country"":null,""Locality"":""Texas"",""QueryInterval"":10,""Mod"":""Rune Quake"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":40,""GameId"":0,""Port"":26002,""Address"":""central.jur4ss1c.net"",""Country"":null,""Locality"":""Iowa"",""QueryInterval"":10,""Mod"":""DM/CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":41,""GameId"":5,""Port"":26001,""Address"":""13.89.226.12"",""Country"":null,""Locality"":""Iowa"",""QueryInterval"":10,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":""{\u0022Engine\u0022: \u0022fte\u0022}"",""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":42,""GameId"":0,""Port"":26000,""Address"":""west.jur4ss1c.net"",""Country"":null,""Locality"":""San Jose"",""QueryInterval"":10,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":43,""GameId"":5,""Port"":26000,""Address"":""73.44.35.81"",""Country"":null,""Locality"":""Chicago"",""QueryInterval"":10,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":""{\u0022Engine\u0022:\u0022fte\u0022}"",""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":50,""GameId"":5,""Port"":26004,""Address"":""embyservice.dynu.net"",""Country"":null,""Locality"":""Texas"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":51,""GameId"":5,""Port"":26001,""Address"":""68.76.157.123"",""Country"":null,""Locality"":""Texas"",""QueryInterval"":10,""Mod"":""Arms"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":56,""GameId"":1,""Port"":26005,""Address"":""crxquake.com"",""Country"":null,""Locality"":""Iowa"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":36,""GameId"":5,""Port"":26000,""Address"":""68.76.157.123"",""Country"":""US"",""Locality"":""Texas"",""QueryInterval"":10,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":12,""GameId"":0,""Port"":26003,""Address"":""qrf.servequake.com"",""Country"":""SE"",""Locality"":""G\u00E4vleborg County"",""QueryInterval"":30,""Mod"":""Coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":13,""GameId"":0,""Port"":26000,""Address"":""qrf.servequake.com"",""Country"":""SE"",""Locality"":""G\u00E4vleborg County"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":47,""GameId"":5,""Port"":26000,""Address"":""ck.homelinuxserver.org"",""Country"":""US"",""Locality"":""California"",""QueryInterval"":10,""Mod"":""CRMOD"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":""{\u0022Engine\u0022: \u0022fte\u0022}"",""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":48,""GameId"":5,""Port"":26000,""Address"":""69.124.248.24"",""Country"":""US"",""Locality"":""New York"",""QueryInterval"":10,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":15,""GameId"":0,""Port"":26000,""Address"":""dm.clan-rum.com"",""Country"":""US"",""Locality"":""North Carolina"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":14,""GameId"":0,""Port"":26000,""Address"":""ctf.clan-rum.com"",""Country"":""US"",""Locality"":""North Carolina"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":9,""GameId"":0,""Port"":26000,""Address"":""bigfoot.quake1.net"",""Country"":""NL"",""Locality"":""Utrecht"",""QueryInterval"":30,""Mod"":""RQ"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":22,""GameId"":0,""Port"":26004,""Address"":""quake.thisserversucks.com"",""Country"":""US"",""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""Misc"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":21,""GameId"":0,""Port"":26001,""Address"":""quake.thisserversucks.com"",""Country"":""US"",""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":20,""GameId"":0,""Port"":26000,""Address"":""quake.thisserversucks.com"",""Country"":""US"",""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":8,""GameId"":0,""Port"":26000,""Address"":""quake.spaceballcity.com"",""Country"":""CA"",""Locality"":""Ontario"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":31,""GameId"":0,""Port"":26000,""Address"":""quake.shmack.net"",""Country"":""US"",""Locality"":""Illinois"",""QueryInterval"":30,""Mod"":""RQ"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":18,""GameId"":0,""Port"":26010,""Address"":""quake.crmod.com"",""Country"":""US"",""Locality"":""Illinois"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":29,""GameId"":0,""Port"":26002,""Address"":""quake.shmack.net"",""Country"":""US"",""Locality"":""Illinois"",""QueryInterval"":30,""Mod"":""RQ"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":25,""GameId"":0,""Port"":26000,""Address"":""fvf.servequake.com"",""Country"":""US"",""Locality"":""Ohio"",""QueryInterval"":30,""Mod"":""Coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":37,""GameId"":5,""Port"":26000,""Address"":""crxquake.com"",""Country"":""US"",""Locality"":""Iowa"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":""{\u0022Engine\u0022: \u0022fte\u0022}"",""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":19,""GameId"":0,""Port"":26000,""Address"":""quake.trinicom.com"",""Country"":""US"",""Locality"":""Louisiana"",""QueryInterval"":30,""Mod"":""CTF"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":46,""GameId"":5,""Port"":26002,""Address"":""embyservice.dynu.net"",""Country"":""US"",""Locality"":""Texas"",""QueryInterval"":10,""Mod"":""Various"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":53,""GameId"":0,""Port"":26002,""Address"":""crxquake.com"",""Country"":""US"",""Locality"":""Iowa"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":54,""GameId"":0,""Port"":26000,""Address"":""sv.netquake.io"",""Country"":""US"",""Locality"":""Ohio"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":55,""GameId"":0,""Port"":26010,""Address"":""sv.netquake.io"",""Country"":""US"",""Locality"":""Ohio"",""QueryInterval"":10,""Mod"":""coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":52,""GameId"":0,""Port"":26002,""Address"":""denver.crxquake.com"",""Country"":""US"",""Locality"":""Colorado"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":32,""GameId"":0,""Port"":26001,""Address"":""quake.trinicom.com"",""Country"":""US"",""Locality"":""Louisiana"",""QueryInterval"":30,""Mod"":""RQ"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":4,""GameId"":0,""Port"":27500,""Address"":""quake.gameguru.com.br"",""Country"":""BR"",""Locality"":""S\u00E3o Paulo"",""QueryInterval"":30,""Mod"":""RQ"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":7,""GameId"":0,""Port"":27600,""Address"":""gameguru.com.br"",""Country"":""BR"",""Locality"":""S\u00E3o Paulo"",""QueryInterval"":30,""Mod"":""FFA"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":49,""GameId"":0,""Port"":26000,""Address"":""jkjunkie.com"",""Country"":""US"",""Locality"":""Washington"",""QueryInterval"":10,""Mod"":""FFA"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":6,""GameId"":0,""Port"":26100,""Address"":""quake.gameguru.com.br"",""Country"":""BR"",""Locality"":""S\u00E3o Paulo"",""QueryInterval"":30,""Mod"":""CRMod"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":10,""GameId"":0,""Port"":27051,""Address"":""quakeroach.net"",""Country"":""LT"",""Locality"":""Siauliai"",""QueryInterval"":30,""Mod"":""Misc"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":5,""GameId"":0,""Port"":26005,""Address"":""quake.thisserversucks.com"",""Country"":""US"",""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""CAX"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":45,""GameId"":5,""Port"":26000,""Address"":""acheesecake.servequake.com"",""Country"":""US"",""Locality"":""New York"",""QueryInterval"":10,""Mod"":""Various"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":23,""GameId"":0,""Port"":26003,""Address"":""quake.thisserversucks.com"",""Country"":""US"",""Locality"":""Virginia"",""QueryInterval"":30,""Mod"":""Coop"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":44,""GameId"":5,""Port"":26000,""Address"":""denver.crxquake.com"",""Country"":""US"",""Locality"":""Colorado"",""QueryInterval"":10,""Mod"":""CRx"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":""{\u0022Engine\u0022: \u0022fte\u0022}"",""Source"":""QSB"",""Metadata"":null},{ ""ServerId"":30,""GameId"":0,""Port"":26001,""Address"":""quake.shmack.net"",""Country"":""US"",""Locality"":""Illinois"",""QueryInterval"":30,""Mod"":""RA"",""Active"":true,""ApiKey"":""00000000-0000-0000-0000-000000000000"",""Parameters"":null,""Source"":""QSB"",""Metadata"":null}]";
        private Db.Server Transform(QSBServer server)
        {
            return new Db.Server
            {
                GameId = server.GameId,
                Port = server.Port,
                Address = server.DNS,
                Locality = server.Location,
                QueryInterval = server.QueryInterval,
                Mod = server.ModificationCode,
                Active = server.Active == 1,
                Parameters = server.Parameters,
                ApiKey = server.ApiKey ?? new Guid().ToString(),
                Source = "QSB"
            };
        }
        public async Task<Db.Server[]> GetServers()
        {
            //using (var httpClient = new HttpClient())
            //{
            //    using (var response = await httpClient.GetAsync("https://servers.quakeone.com/api/servers/manage/server"))
            //    {
            //        string apiResponse = await response.Content.ReadAsStringAsync();
            List<Db.Server> qsbServers;
            try
            {
                qsbServers = JsonSerializer.Deserialize<List<Db.Server>>(DUMP);
            }
            catch (Exception ex)
            {
                Logging.LogError(ex, "Failed to parse feed from QSB Server");
                return new Db.Server[0];
            }
            return qsbServers
                .Select(s =>
                {
                    s.ServerId = 0;
                    return s;
                })
                .ToArray();
            //    }
            //}
        }
    }
}
